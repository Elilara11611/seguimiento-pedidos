# -*- coding: utf-8 -*-
"""Untitled5.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1qX7SSV2U2ZgxJme9sQUTbvra202ArJFj
"""


# archivo: seguimiento_pedidos.py
import streamlit as st
import pandas as pd
import datetime

# Cargar datos
try:
    pedidos = pd.read_csv("pedidos.csv")
except FileNotFoundError:
    pedidos = pd.DataFrame(columns=["ID", "Solicitante", "DescripciÃ³n", "Estado", "Historial"])

# FunciÃ³n para guardar los datos
def guardar_pedidos(df):
    df.to_csv("pedidos.csv", index=False)

# TÃ­tulo
st.title("ğŸ“¦ Seguimiento de Pedidos - ProveedurÃ­a")

# SecciÃ³n para agregar pedido
st.header("ğŸ“ Nuevo Pedido")
with st.form("form_pedido"):
    id_pedido = st.text_input("ID del Pedido")
    solicitante = st.text_input("Nombre del solicitante")
    descripcion = st.text_area("DescripciÃ³n del pedido")
    if st.form_submit_button("Agregar"):
        nuevo_pedido = {
            "ID": id_pedido,
            "Solicitante": solicitante,
            "DescripciÃ³n": descripcion,
            "Estado": "Solicitado",
            "Historial": f"{datetime.date.today()} - Pedido creado por {solicitante}"
        }
        pedidos = pedidos.append(nuevo_pedido, ignore_index=True)
        guardar_pedidos(pedidos)
        st.success("âœ… Pedido agregado")

# Mostrar pedidos existentes
st.header("ğŸ“‹ Pedidos Existentes")
if not pedidos.empty:
    st.dataframe(pedidos[["ID", "Solicitante", "DescripciÃ³n", "Estado"]])

    # Actualizar pedido
    st.subheader("ğŸ”„ Actualizar Estado")
    pedido_seleccionado = st.selectbox("Seleccionar ID de pedido", pedidos["ID"])
    nuevo_estado = st.selectbox("Nuevo estado", ["CotizaciÃ³n solicitada", "Esperando aprobaciÃ³n/pago", "En proceso de entrega", "Entregado", "Demora: proveedor / pago / gestiÃ³n interna"])

    if st.button("Actualizar estado"):
        idx = pedidos[pedidos["ID"] == pedido_seleccionado].index[0]
        pedidos.at[idx, "Estado"] = nuevo_estado
        pedidos.at[idx, "Historial"] += f"\n{datetime.date.today()} - Estado actualizado a '{nuevo_estado}'"
        guardar_pedidos(pedidos)
        st.success("ğŸ” Estado actualizado correctamente")

    # Ver historial
    st.subheader("ğŸ“œ Historial del Pedido")
    st.text(pedidos[pedidos["ID"] == pedido_seleccionado]["Historial"].values[0])
else:
    st.info("No hay pedidos registrados aÃºn.")

